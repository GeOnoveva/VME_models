---
title: "R Notebook"
output: html_notebook
---

# Load the working environment
```{r}
library(ranger)
library(spm)
library(yardstick)

# taxonary
taxonary <- read_xlsx(file.path(Data,"Taxonary.xlsx"), sheet = 1) # needs to be closed

# set vme
vme <- "Hard bottom sponge aggregations"
remove <- c("Mycale lingua", "Phakellia sp.", "Axinellidae", "Axinella infundibuliformis")
indicators <- taxonary$Reference_List[which(taxonary$VME_Burgos_etal_2020==vme)]
indicators <- indicators[-which(indicators%in%remove)]

# read model
m <- readRDS(file.path(outpath,paste(vme,"minus", paste(substr(remove, 1,7), collapse=", "), "model.rda" )))

# re-generate v_test and v_train
v <- read.csv(file.path(savepath, paste(vme, "minus", paste(substr(remove, 1,7), collapse=", "), "v.csv", collapse=" ")))
v <- v %>% 
      mutate_at(vars(  landscape, sedclass, seddan, sedmil    ), factor)
data_split <- read.csv(file.path(outpath, paste(vme,"minus", paste(substr(remove, 1,7), collapse=", "), "data split.csv")))
v_train <- v %>% left_join(filter(data_split, data_split$set=="train")) %>% filter(!is.na(set))
v_test <- v %>% left_join(filter(data_split, data_split$set=="test")) %>% filter(!is.na(set))

# predict with m3
vme.qrf2 <- predict(m,  v_test,
type="quantiles", quantiles=quantiles)$predictions
v_test$vme.qrf2pr = vme.qrf2[,2]
v_test$vme.qrf2var = (vme.qrf2[,3]-vme.qrf2[,1])/2

# test m3
predicted <- v_test$vme.qrf2pr
observed <- v_test %>%
dplyr::select(vmeind_density)
vecv <- vecv(pull(observed),pull(data.frame(unlist(predicted))))
ccc <- ccc_vec(pull(observed),predicted)

```

Here is the summary for the model for vme 

```{r}
vme
```

With indicators
```{r}
indicators
```

with model
```{r}
m
```

with evaluation
```{r}
vecv
```
and
```{r}
ccc
```

