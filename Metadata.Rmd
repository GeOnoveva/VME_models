---
title: "Produktark: `r cat(paste(vme, "Hot Spots"))`
author: "Genoveva Gonzalez Mirelis"
date: "2023-10-27"
output: pdf_document
code_folding: "hide"
---
 
```{r echo=FALSE}
# libraries
library(ranger)
library(spm)
library(yardstick)
library(readxl)
library(dplyr)
library(tinytex)

# paths
Data <- "G:/R_projects/VH_MarVid/Data"
outpath <- "G:/R_projects/VH_MarVid/Results"
savepath <- "G:/R_projects/VH_MarVid/Intermediate_objects"

# quantiles
quantiles = c((1-.682)/2, 0.5, 1-(1-.682)/2)

# taxonary
taxonary <- read_xlsx(file.path(Data,"Taxonary.xlsx"), sheet = 1) # needs to be closed

# vme and indicators
vme <- "Hard bottom sponge aggregations"
remove <- c("Mycale lingua", "Phakellia sp.", "Axinellidae", "Axinella infundibuliformis")
indicators <- taxonary$Reference_List[which(taxonary$VME_Burgos_etal_2020==vme)]
indicators <- indicators[-which(indicators%in%remove)]

# model
m <- readRDS(file.path(outpath,paste(vme,"minus", paste(substr(remove, 1,7), collapse=", "), "model.rda" )))

# re-generate v_test and v_train
v <- read.csv(file.path(savepath, paste(vme, "minus", paste(substr(remove, 1,7), collapse=", "), "v.csv", collapse=" ")))
v <- v %>% 
      mutate_at(vars(  landscape, sedclass, seddan, sedmil    ), factor)
data_split <- read.csv(file.path(outpath, paste(vme,"minus", paste(substr(remove, 1,7), collapse=", "), "data split.csv")))
v_train <- v %>% left_join(filter(data_split, data_split$set=="train")) %>% filter(!is.na(set))
v_test <- v %>% left_join(filter(data_split, data_split$set=="test")) %>% filter(!is.na(set))

# predict with m3
vme.qrf2 <- predict(m,  v_test,
type="quantiles", quantiles=quantiles)$predictions
v_test$vme.qrf2pr = vme.qrf2[,2]
v_test$vme.qrf2var = (vme.qrf2[,3]-vme.qrf2[,1])/2

# test m3
predicted <- v_test$vme.qrf2pr
observed <- v_test %>%
dplyr::select(vmeind_density)
vecv <- vecv(pull(observed),pull(data.frame(unlist(predicted))))
ccc <- ccc_vec(pull(observed),predicted)
```

# Description
This vector dataset shows the "hot spots" (high predicted density areas) for the Vulnerable Marine Ecosystem referred to as:
```{r}
vme
```
The definition for this VME followed

@book{buhl2019vulnerable,
  title={Vulnerable marine ecosystems (VMEs): Coral and sponge VMEs in Arctic and sub-Arctic waters--Distribution and threats},
  author={Buhl-Mortensen, Lene and Burgos, Julian Mariano and Steingrund, Petur and Buhl-Mortensen, P{\aa}l and {\'O}lafsd{\'o}ttir, Steinunn H and Ragnarsson, Stef{\'a}n {\'A}},
  volume={2019519},
  year={2019},
  publisher={Nordic Council of Ministers}
}

 and also
 
 @article{burgos2020predicting,
  title={Predicting the distribution of indicator taxa of vulnerable marine ecosystems in the Arctic and sub-arctic waters of the Nordic Seas},
  author={Burgos, Julian M and Buhl-Mortensen, Lene and Buhl-Mortensen, P{\aa}l and {\'O}lafsd{\'o}ttir, Steinunn H and Steingrund, Petur and Ragnarsson, Stef{\'a}n {\'A} and Skagseth, {\O}ystein},
  journal={Frontiers in Marine Science},
  volume={7},
  pages={131},
  year={2020},
  publisher={Frontiers Media SA}
}

Therefore, this VME is defined by occurrence of the following indicators:
```{r}
indicators
```

# Goal and usage
The goal is to highlight specific areas which may be subject to special management requirements due to the expected high density of VME indicators, i.e., the potential presence of a VME (cite Baco Taylor?).

# Owner and contact information
Havforskningsinstituttet
Fagekspert: Genoveva Gonzalez Mirelis: <genoveva@hi.no>
Datateknisk: Kjell Bakkeplass: kjell.bakkeplass@hi.no>

# Resolution/Scale
```{r}
paste("1:", sprintf("%.0f",mna*2000))
```

# Coverage
The coverage of this dataset is the entire MAREANO area as of 2020. It is the same as the latest biotope map, shown here: 

# Sources and method


with model
```{r}
m
```

with evaluation
```{r}
vecv
```
and
```{r}
ccc
```

# Updating

# Deliverable
## Format
## Projection
## Restrictions

Links
